import{_ as K,r as i,l as j,o as J,m as Q,c,g as H,a,i as W,w as M,v as I,F as S,e as A,t as d,d as X,p as Y,n as L,u as Z,f as v,q as ee}from"./index-BueJBwtx.js";import{N as te}from"./NavBar-Cx_hJYJ8.js";import{initializeApp as ae}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";import{getFirestore as oe,collection as U,setDoc as ie,doc as ne,updateDoc as se,query as re,where as le,getDocs as ue}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";const ce={id:"startLiveContainer"},de={id:"form-Of-Live-Setup-Container"},ve={id:"streamName-Section"},me={id:"streamDescription-Section"},pe={id:"streamCategory-Section"},fe={id:"category-grid"},ge=["onClick"],he={class:"category-icon"},ye={class:"category-name"},we={id:"selected-count"},_e={id:"microphone-section"},De={id:"microphone-container"},Se=["disabled"],be={value:""},Ce=["value"],xe={class:"status-text"},Me={key:0,id:"audio-visualizer"},Ae=["disabled"],Le={__name:"StartLiveView",setup(Re){const q=ae({apiKey:"AIzaSyAQpMoxAKJrkave5D9e8CqKeLffCCUeGAw",authDomain:"vexa-d596e.firebaseapp.com",projectId:"vexa-d596e",storageBucket:"vexa-d596e.appspot.com",messagingSenderId:"79833394084",appId:"1:79833394084:web:1e5f41859b4125ef342f31"}),b=oe(q),T=U(b,"vexaUsers");U(b,"vexaRooms");const C=Z(),g=i(""),h=i(""),s=i([]),r=i(""),R=i([]),w=i(!1),u=i(null),m=i(null),p=i(null),x=i(Array(12).fill(0)),l=i("inactive"),k=i([{id:1,name:"Gaming",icon:"ðŸŽ®"},{id:2,name:"Music",icon:"ðŸŽµ"},{id:3,name:"Art & Design",icon:"ðŸŽ¨"},{id:4,name:"Technology",icon:"ðŸ’»"},{id:5,name:"Lifestyle",icon:"âœ¨"}]);function B(o){const e=s.value.indexOf(o);e>-1?s.value.splice(e,1):s.value.length<2&&s.value.push(o)}const _=j(()=>g.value.trim()!==""&&h.value.trim()!==""&&s.value.length===2&&r.value!=="");function N(){return!g.value.trim()||!h.value.trim()?"Fill Required Fields":s.value.length!==2?"Select 2 Categories":r.value?"Go Live":"Select Microphone"}function V(){switch(l.value){case"inactive":return"No microphone selected";case"requesting":return"Requesting permission...";case"active":return"Microphone active";case"error":return"Permission denied";default:return"Unknown status"}}async function F(){try{l.value="requesting";const o=await navigator.mediaDevices.getUserMedia({audio:!0});w.value=!0;const e=await navigator.mediaDevices.enumerateDevices();R.value=e.filter(t=>t.kind==="audioinput"),o.getTracks().forEach(t=>t.stop()),l.value="inactive"}catch(o){console.error("Error accessing microphones:",o),w.value=!1,l.value="error"}}async function P(){if(!r.value){D();return}try{l.value="requesting",D();const o=await navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:r.value}}});u.value=o,l.value="active",z()}catch(o){console.error("Error starting microphone:",o),l.value="error",r.value=""}}function z(){if(!u.value)return;m.value=new(window.AudioContext||window.webkitAudioContext),p.value=m.value.createAnalyser(),m.value.createMediaStreamSource(u.value).connect(p.value),p.value.fftSize=32;const e=p.value.frequencyBinCount,t=new Uint8Array(e);function n(){p.value.getByteFrequencyData(t);for(let f=0;f<12;f++){const y=Math.floor(f/12*e);x.value[f]=t[y]/255*100}requestAnimationFrame(n)}n()}function D(){u.value&&u.value.getTracks().forEach(o=>o.stop()),m.value&&m.value.close(),u.value=null,m.value=null,p.value=null,x.value=Array(12).fill(0)}function E(o){const t=`; ${document.cookie}`.split(`; ${o}=`);return t.length===2?decodeURIComponent(t.pop().split(";").shift()):null}async function G(o){const e=re(T,le("username","==",o)),t=await ue(e);if(!t.empty){const n=t.docs[0];return{id:n.id,docRef:n.ref,...n.data()}}return null}function $(){return"vexaroom_"+Math.random().toString(36).substring(2,12)+"_"+Date.now()}const O=async()=>{if(_.value)try{const o=E("vexaUser");if(!o)return alert("Please log in to start a live stream."),C.push("/");const e=await G(o);if(!e)return alert("User data not found. Please log in again."),C.push("/");const t=k.value.filter(y=>s.value.includes(y.id)).map(y=>y.name),n=$(),f={RoomID:n,"Room-Owner":e.username,"Room-Owner-PeerID":e.PeerID,"Room-Name":g.value.trim(),"Room-Desc":h.value.trim(),"Room-Category":t,"Participants-Usernames":[e.username],createdAt:new Date,isActive:!0,startTime:new Date};await ie(ne(b,"vexaRooms",e.username),f),await se(e.docRef,{isLiveNow:!0,currentRoomID:n}),alert(`Live stream started! Room owner: ${e.username}`),C.push({name:"AudioLiveView",params:{owner:e.username}}),D()}catch(o){console.error("Error creating room:",o),alert("Failed to start live stream. Please try again.")}};return J(()=>F()),Q(()=>D()),(o,e)=>(v(),c(S,null,[H(te),a("div",ce,[e[8]||(e[8]=a("h1",{id:"startLiveTitle"},"Start Live",-1)),a("div",de,[a("form",{id:"room-form",onSubmit:W(O,["prevent"])},[a("div",ve,[e[3]||(e[3]=a("label",{id:"stream-Title"},"Stream Title",-1)),M(a("input",{id:"stream-Title-Input","onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),placeholder:"Enter your stream title...",maxlength:"100"},null,512),[[I,g.value]])]),a("div",me,[e[4]||(e[4]=a("label",{id:"stream-Description"},"Stream Description",-1)),M(a("textarea",{id:"stream-Description-Input","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"Describe what your stream is about...",maxlength:"500",rows:"3"},null,512),[[I,h.value]])]),a("div",pe,[e[5]||(e[5]=a("label",{id:"stream-Category"},"Stream Categories (Select 2)",-1)),a("div",fe,[(v(!0),c(S,null,A(k.value,t=>(v(),c("div",{key:t.id,class:L(["category-item",{selected:s.value.includes(t.id)}]),onClick:n=>B(t.id)},[a("div",he,d(t.icon),1),a("span",ye,d(t.name),1)],10,ge))),128))]),a("div",we,d(s.value.length)+"/2 selected",1)]),a("div",_e,[e[7]||(e[7]=a("label",{id:"microphone-label"},"Microphone",-1)),a("div",De,[M(a("select",{id:"microphone-select","onUpdate:modelValue":e[2]||(e[2]=t=>r.value=t),onChange:P,disabled:!w.value},[a("option",be,d(w.value?"Select Microphone":"Getting microphones..."),1),(v(!0),c(S,null,A(R.value,t=>(v(),c("option",{key:t.deviceId,value:t.deviceId},d(t.label||`Microphone ${t.deviceId.slice(0,8)}`),9,Ce))),128))],40,Se),[[Y,r.value]]),a("div",{id:"mic-status",class:L(l.value)},[e[6]||(e[6]=a("div",{class:"status-indicator"},null,-1)),a("span",xe,d(V()),1)],2),r.value&&u.value?(v(),c("div",Me,[(v(),c(S,null,A(12,t=>a("div",{class:"audio-bar",key:t,style:ee({height:x.value[t]+"%"})},null,4)),64))])):X("",!0)])]),a("button",{id:"goLiveBtn",type:"submit",disabled:!_.value,class:L({disabled:!_.value})},d(_.value?"Go Live":N()),11,Ae)],32)])])],64))}},Be=K(Le,[["__scopeId","data-v-370ab7cc"]]);export{Be as default};
