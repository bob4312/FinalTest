import{_ as N,s as T,r as c,l as j,x as $,o as q,c as n,a as e,d as z,t as l,F as g,y as b,e as D,i as E,w as F,v as K,u as W,z as G,f as r}from"./index-DjsB7_Em.js";import{$ as A}from"./bundler-CViGtuft.js";import{getApps as J,initializeApp as Q,getApp as X}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";import{getFirestore as Y,doc as R,onSnapshot as Z,deleteDoc as ee,collection as oe,query as te,where as se,getDocs as ae,updateDoc as ne}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";const re={id:"live-root"},ie={key:0,class:"loading"},le={key:1,id:"live-section"},ce={class:"stream-layout"},ue={class:"stream-info"},de={class:"stream-meta"},pe={key:0,class:"stop-section"},ve={class:"audio-section"},me={class:"participants-section"},fe={class:"chat-section"},he={class:"chat-box"},ye=["disabled"],_e={__name:"AudioLiveView",setup(we){const I={apiKey:"AIzaSyAQpMoxAKJrkave5D9e8CqKeLffCCUeGAw",authDomain:"vexa-d596e.firebaseapp.com",projectId:"vexa-d596e",storageBucket:"vexa-d596e.appspot.com",messagingSenderId:"79833394084",appId:"1:79833394084:web:1e5f41859b4125ef342f31"},S=J().length===0?Q(I):X(),f=Y(S),P=T(),U=W(),h=P.params.owner,u=decodeURIComponent((document.cookie.split("; ").find(t=>t.startsWith("vexaUser="))||"").split("=")[1]||""),i=c({}),v=c([]),k=c([]),d=c(""),x=c(!1),y=j(()=>i.value["Room-Owner"]===u),m=c(null),p=c(null);let s=null;async function C(){s&&s.destroy(),m.value&&m.value.getTracks().forEach(o=>o.stop());const t=R(f,"vexaRooms",h);try{await ee(t),console.log("Room deleted")}catch(o){console.error("Error deleting room:",o)}U.push("/home")}async function V(){try{m.value=await navigator.mediaDevices.getUserMedia({audio:!0}),await G(),p.value&&(p.value.srcObject=m.value,await p.value.play().catch(()=>{}))}catch(t){console.error("Host audio error:",t)}}function L(){s=new A(i.value["Room-Owner-PeerID"]),s.on("call",t=>t.answer(m.value))}async function M(){const t=oe(f,"vexaUsers"),o=te(t,se("username","==",u)),a=await ae(o),_=a.empty?null:a.docs[0].data().PeerID;if(!_){console.error("Viewer PeerID not found for",u);return}s=new A(_),s.on("open",()=>{s.call(i.value["Room-Owner-PeerID"],null).on("stream",H=>{p.value&&(p.value.srcObject=H)})}),s.on("error",w=>console.error("Peer error:",w));const B=R(f,"vexaRooms",h);if(!v.value.includes(u))try{await ne(B,{"Participants-Usernames":[...v.value,u]})}catch(w){console.warn("Could not update participants:",w)}}function O(){d.value.trim()&&(k.value.push({sender:u,text:d.value.trim()}),d.value="")}return $(()=>{y.value?C():s&&s.destroy()}),q(()=>{const t=R(f,"vexaRooms",h);Z(t,o=>{if(!o.exists()){console.error("No room for owner:",h);return}i.value={id:o.id,...o.data()},v.value=o.data()["Participants-Usernames"]||[],x.value||(x.value=!0,y.value?V().then(L):M())})}),(t,o)=>(r(),n("div",re,[x.value?(r(),n("div",le,[e("div",ce,[e("section",ue,[e("h2",null,l(i.value["Room-Name"]),1),e("p",null,l(i.value["Room-Desc"]),1),e("div",de,[e("span",null,"👤 Host: "+l(i.value["Room-Owner"]),1),e("span",null,"📁 Categories: "+l(i.value["Room-Category"].join(", ")),1),e("span",null,"👥 Viewers: "+l(v.value.length),1)]),y.value?(r(),n("div",pe,[e("button",{onClick:C,class:"stop-btn"},"🛑 Stop Stream")])):z("",!0),e("div",ve,[e("h4",null,[y.value?(r(),n(g,{key:0},[b("🎧 Live Monitor")],64)):(r(),n(g,{key:1},[b("🔊 Listening")],64))]),e("audio",{ref_key:"localAudio",ref:p,controls:"",autoplay:"",playsinline:"",class:"audio-player"},null,512)]),e("div",me,[o[2]||(o[2]=e("h4",null,"🟢 Currently Watching",-1)),e("ul",null,[(r(!0),n(g,null,D(v.value,a=>(r(),n("li",{key:a},"👤 "+l(a),1))),128))])])]),e("section",fe,[o[3]||(o[3]=e("div",{class:"chat-header"},"💬 Live Chat",-1)),e("div",he,[(r(!0),n(g,null,D(k.value,(a,_)=>(r(),n("div",{key:_,class:"chat-message"},[e("strong",null,l(a.sender)+":",1),b(" "+l(a.text),1)]))),128))]),e("form",{onSubmit:E(O,["prevent"]),class:"chat-input"},[F(e("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>d.value=a),placeholder:"Type your message..."},null,512),[[K,d.value]]),e("button",{type:"submit",disabled:!d.value},"Send",8,ye)],32)])])])):(r(),n("div",ie,o[1]||(o[1]=[e("p",null,"Loading stream data...",-1)])))]))}},ke=N(_e,[["__scopeId","data-v-bcdc3c9d"]]);export{ke as default};
