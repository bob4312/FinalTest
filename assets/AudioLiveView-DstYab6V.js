import{_ as $,x as z,r as u,m as F,y as K,o as W,c as n,a as e,d as G,t as l,F as x,z as C,e as I,i as J,w as Q,v as X,u as Y,A as Z,f as r}from"./index-vCbE4hjX.js";import{$ as U}from"./bundler-DyOlRpoC.js";import{getApps as ee,initializeApp as oe,getApp as te}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";import{getFirestore as se,doc as R,onSnapshot as ae,deleteDoc as ne,collection as S,query as L,where as P,getDocs as V,updateDoc as M}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";import"./_commonjsHelpers-gnU0ypJ3.js";const re={id:"live-root"},ie={key:0,class:"loading"},le={key:1,id:"live-section"},ce={class:"stream-layout"},ue={class:"stream-info"},de={class:"stream-meta"},ve={key:0,class:"stop-section"},pe={class:"audio-section"},me={class:"participants-section"},fe={class:"chat-section"},he={class:"chat-box"},we=["disabled"],ye={__name:"AudioLiveView",setup(_e){const N={apiKey:"AIzaSyAQpMoxAKJrkave5D9e8CqKeLffCCUeGAw",authDomain:"vexa-d596e.firebaseapp.com",projectId:"vexa-d596e",storageBucket:"vexa-d596e.appspot.com",messagingSenderId:"79833394084",appId:"1:79833394084:web:1e5f41859b4125ef342f31"},O=ee().length===0?oe(N):te(),d=se(O),B=z(),H=Y(),w=B.params.owner,v=decodeURIComponent((document.cookie.split("; ").find(t=>t.startsWith("vexaUser="))||"").split("=")[1]||""),i=u({}),y=u([]),A=u([]),p=u(""),b=u(!1),_=F(()=>i.value["Room-Owner"]===v),g=u(null),m=u(null);let a=null;async function D(){a&&a.destroy(),g.value&&g.value.getTracks().forEach(f=>f.stop());const t=R(d,"vexaRooms",w);try{await ne(t),console.log("Room deleted")}catch(f){console.error("Error deleting room:",f)}const o=S(d,"vexaUsers"),s=L(o,P("username","==",w)),c=await V(s);if(c.empty)console.log("No user found with that username");else{const h=c.docs[0].id,k=R(d,"vexaUsers",h);await M(k,{isLiveNow:!1})}H.push("/home")}async function T(){try{g.value=await navigator.mediaDevices.getUserMedia({audio:!0}),await Z(),m.value&&(m.value.srcObject=g.value,await m.value.play().catch(()=>{}))}catch(t){console.error("Host audio error:",t)}}function j(){a=new U(i.value["Room-Owner-PeerID"]),a.on("call",t=>t.answer(g.value))}async function q(){const t=S(d,"vexaUsers"),o=L(t,P("username","==",v)),s=await V(o),c=s.empty?null:s.docs[0].data().PeerID;if(!c){console.error("Viewer PeerID not found for",v);return}a=new U(c),a.on("open",()=>{a.call(i.value["Room-Owner-PeerID"],null).on("stream",k=>{m.value&&(m.value.srcObject=k)})}),a.on("error",h=>console.error("Peer error:",h));const f=R(d,"vexaRooms",w);if(!y.value.includes(v))try{await M(f,{"Participants-Usernames":[...y.value,v]})}catch(h){console.warn("Could not update participants:",h)}}function E(){p.value.trim()&&(A.value.push({sender:v,text:p.value.trim()}),p.value="")}return window.addEventListener("beforeunload",()=>{_.value&&D()}),K(()=>{_.value?D():a&&a.destroy()}),W(()=>{const t=R(d,"vexaRooms",w);ae(t,o=>{if(!o.exists()){console.error("No room for owner:",w);return}i.value={id:o.id,...o.data()},y.value=o.data()["Participants-Usernames"]||[],b.value||(b.value=!0,_.value?T().then(j):q())})}),(t,o)=>(r(),n("div",re,[b.value?(r(),n("div",le,[e("div",ce,[e("section",ue,[e("h2",null,l(i.value["Room-Name"]),1),e("p",null,l(i.value["Room-Desc"]),1),e("div",de,[e("span",null,"👤 Host: "+l(i.value["Room-Owner"]),1),e("span",null,"📁 Categories: "+l(i.value["Room-Category"].join(", ")),1),e("span",null,"👥 Viewers: "+l(y.value.length),1)]),_.value?(r(),n("div",ve,[e("button",{onClick:D,class:"stop-btn"},"🛑 Stop Stream")])):G("",!0),e("div",pe,[e("h4",null,[_.value?(r(),n(x,{key:0},[C("🎧 Live Monitor")],64)):(r(),n(x,{key:1},[C("🔊 Listening")],64))]),e("audio",{ref_key:"localAudio",ref:m,controls:"",autoplay:"",playsinline:"",class:"audio-player"},null,512)]),e("div",me,[o[2]||(o[2]=e("h4",null,"🟢 Currently Watching",-1)),e("ul",null,[(r(!0),n(x,null,I(y.value,s=>(r(),n("li",{key:s},"👤 "+l(s),1))),128))])])]),e("section",fe,[o[3]||(o[3]=e("div",{class:"chat-header"},"💬 Live Chat",-1)),e("div",he,[(r(!0),n(x,null,I(A.value,(s,c)=>(r(),n("div",{key:c,class:"chat-message"},[e("strong",null,l(s.sender)+":",1),C(" "+l(s.text),1)]))),128))]),e("form",{onSubmit:J(E,["prevent"]),class:"chat-input"},[Q(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>p.value=s),placeholder:"Type your message..."},null,512),[[X,p.value]]),e("button",{type:"submit",disabled:!p.value},"Send",8,we)],32)])])])):(r(),n("div",ie,o[1]||(o[1]=[e("p",null,"Loading stream data...",-1)])))]))}},ke=$(ye,[["__scopeId","data-v-f612526a"]]);export{ke as default};
