import{r as l,o as _,c as d,f as u,a as r,w as b,b as y,d as w,t as x,v as k,g as I}from"./index-BcyifOd6.js";import{$ as D}from"./bundler-CViGtuft.js";const L={style:{padding:"2rem","max-width":"600px",margin:"auto"}},M=["disabled"],P={key:0,style:{color:"gray","font-size":".9rem"}},V={__name:"Listener",setup(g){function p(){return Math.random().toString(36).substring(2,7)}const n=l(p()),m=l(""),s=l(!1),i=l(!1),a=l(null);let c=null,v=null;_(async()=>{try{v=await navigator.mediaDevices.getUserMedia({audio:!0}),i.value=!0}catch(e){console.warn("Listener: mic access denied",e)}c=new D(n.value),c.on("open",e=>{n.value=e,console.log("Listener Peer ready with ID:",e)}),c.on("error",e=>{console.error("PeerJS error (listener):",e),alert("Listener error: "+e)})});async function f(){const e=m.value.trim();if(e.length!==5)return alert("Room ID must be exactly 5 characters.");if(!i.value)return alert("Mic not ready; please allow microphone access.");console.log("Calling host:",e);const o=c.call(e,v);o.on("stream",async t=>{if(console.log("🔊 Received remote stream",t),!!a.value){a.value.srcObject=t,a.value.volume=1;try{await a.value.play(),s.value=!0,console.log("▶️ Playback started")}catch(h){console.error("❌ Playback failed:",h)}}}),o.on("error",t=>{console.error("Call error:",t),alert("Could not connect to host: "+t)}),o.on("close",()=>{console.log("Host closed the call"),s.value=!1})}return(e,o)=>(u(),d("div",L,[o[2]||(o[2]=r("h2",null,"Listener Mode",-1)),r("p",null,[o[1]||(o[1]=w("Your Listener ID: ")),r("strong",null,x(n.value),1)]),o[3]||(o[3]=r("label",{for:"hostId"},"Enter Room ID:",-1)),b(r("input",{id:"hostId","onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),placeholder:"e.g. abcde",style:{display:"block",width:"100%",margin:".5rem 0",padding:".5rem"}},null,512),[[k,m.value]]),r("button",{onClick:f,disabled:s.value||!i.value}," 👂 Join Stream ",8,M),i.value?y("",!0):(u(),d("p",P," Allow mic access to connect... ")),s.value?(u(),d("audio",{key:1,ref_key:"remoteAudio",ref:a,autoplay:"",controls:"",playsinline:"",style:{display:"block",width:"100%","margin-top":"1rem"}},null,512)):y("",!0)]))}},$={style:{padding:"2rem","max-width":"600px",margin:"auto"}},N={__name:"ListenerView",setup(g){return(p,n)=>(u(),d("div",$,[I(V)]))}};export{N as default};
