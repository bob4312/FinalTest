import{_ as S,s as V,r,l as O,o as P,c as s,a as e,t as l,F as m,x as y,e as b,i as H,w as j,v as B,y as N,f as n}from"./index-BueJBwtx.js";import{$ as k}from"./bundler-CViGtuft.js";import{getApps as T,initializeApp as $,getApp as F}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";import{getFirestore as K,doc as R,onSnapshot as z,updateDoc as W}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";const q={id:"live-root"},E={key:0,class:"loading"},G={key:1,id:"live-section"},J={class:"stream-layout"},Q={class:"stream-info"},X={class:"stream-meta"},Y={class:"audio-section"},Z={class:"participants-section"},ee={class:"chat-section"},te={class:"chat-box"},oe=["disabled"],ae={__name:"AudioLiveView",setup(se){const A={apiKey:"AIzaSyAQpMoxAKJrkave5D9e8CqKeLffCCUeGAw",authDomain:"vexa-d596e.firebaseapp.com",projectId:"vexa-d596e",storageBucket:"vexa-d596e.appspot.com",messagingSenderId:"79833394084",appId:"1:79833394084:web:1e5f41859b4125ef342f31"},C=T().length===0?$(A):F(),w=K(C),f=V().params.owner,v=decodeURIComponent((document.cookie.split("; ").find(o=>o.startsWith("vexaUser="))||"").split("=")[1]||""),i=r({}),d=r([]),g=r([]),u=r(""),h=r(!1),x=O(()=>i.value["Room-Owner"]===v),_=r(null),c=r(null);let p=null;async function D(){try{_.value=await navigator.mediaDevices.getUserMedia({audio:!0}),await N(),c.value&&(c.value.srcObject=_.value,await c.value.play().catch(()=>{}))}catch(o){console.error("Host audio error:",o)}}function I(){p=new k(i.value["Room-Owner-PeerID"]),p.on("call",o=>o.answer(_.value))}async function L(){p=new k,p.on("open",()=>{p.call(i.value["Room-Owner-PeerID"],null).on("stream",a=>{c.value&&(c.value.srcObject=a)})});const o=R(w,"vexaRooms",f);if(!d.value.includes(v))try{await W(o,{"Participants-Usernames":[...d.value,v]})}catch(t){console.warn("Could not update participants:",t)}}function U(){u.value.trim()&&(g.value.push({sender:v,text:u.value.trim()}),u.value="")}return P(()=>{const o=R(w,"vexaRooms",f);z(o,t=>{if(!t.exists()){console.error("No room for owner:",f);return}i.value={id:t.id,...t.data()},d.value=t.data()["Participants-Usernames"]||[],h.value||(h.value=!0,x.value?D().then(I):L())})}),(o,t)=>(n(),s("div",q,[h.value?(n(),s("div",G,[e("div",J,[e("section",Q,[e("h2",null,l(i.value["Room-Name"]),1),e("p",null,l(i.value["Room-Desc"]),1),e("div",X,[e("span",null,"👤 Host: "+l(i.value["Room-Owner"]),1),e("span",null,"📁 Categories: "+l(i.value["Room-Category"].join(", ")),1),e("span",null,"👥 Viewers: "+l(d.value.length),1)]),e("div",Y,[e("h4",null,[x.value?(n(),s(m,{key:0},[y("🎧 Live Monitor")],64)):(n(),s(m,{key:1},[y("🔊 Listening")],64))]),e("audio",{ref_key:"localAudio",ref:c,controls:"",autoplay:"",playsinline:"",class:"audio-player"},null,512)]),e("div",Z,[t[2]||(t[2]=e("h4",null,"🟢 Currently Watching",-1)),e("ul",null,[(n(!0),s(m,null,b(d.value,a=>(n(),s("li",{key:a},"👤 "+l(a),1))),128))])])]),e("section",ee,[t[3]||(t[3]=e("div",{class:"chat-header"},"💬 Live Chat",-1)),e("div",te,[(n(!0),s(m,null,b(g.value,(a,M)=>(n(),s("div",{key:M,class:"chat-message"},[e("strong",null,l(a.sender)+":",1),y(" "+l(a.text),1)]))),128))]),e("form",{onSubmit:H(U,["prevent"]),class:"chat-input"},[j(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),placeholder:"Type your message..."},null,512),[[B,u.value]]),e("button",{type:"submit",disabled:!u.value},"Send",8,oe)],32)])])])):(n(),s("div",E,t[1]||(t[1]=[e("p",null,"Loading stream data...",-1)])))]))}},ce=S(ae,[["__scopeId","data-v-8b10c195"]]);export{ce as default};
