import{r,o as _,c as u,f as m,a,w as g,b,d as w,t as x,v as k,h as I,g as D}from"./index-Iy8hTiz0.js";import{$ as L}from"./bundler-CViGtuft.js";const M={style:{padding:"2rem","max-width":"600px",margin:"auto"}},P=["disabled"],S={key:0,style:{color:"gray","font-size":".9rem"}},V={__name:"Listener",setup(y){function p(){return Math.random().toString(36).substring(2,7)}const n=r(p()),d=r(""),s=r(!1),i=r(!1),l=r(null);let c=null,v=null;_(async()=>{try{v=await navigator.mediaDevices.getUserMedia({audio:!0}),i.value=!0}catch(e){console.warn("Listener: mic access denied",e)}c=new L(n.value),c.on("open",e=>{n.value=e,console.log("Listener Peer ready with ID:",e)}),c.on("error",e=>{console.error("PeerJS error (listener):",e),alert("Listener error: "+e)})});async function f(){const e=d.value.trim();if(e.length!==5)return alert("Room ID must be exactly 5 characters.");if(!i.value)return alert("Mic not ready; please allow microphone access.");console.log("Calling host:",e);const o=c.call(e,v);o.on("stream",t=>{console.log("🔊 Received remote stream",t),l.value.srcObject=t,l.value.volume=1,l.value.onloadedmetadata=()=>{l.value.play().then(()=>{s.value=!0,console.log("▶️ Playback started")}).catch(h=>{console.error("❌ Playback failed:",h)})}}),o.on("error",t=>{console.error("Call error:",t),alert("Could not connect to host: "+t)}),o.on("close",()=>{console.log("Host closed the call"),s.value=!1})}return(e,o)=>(m(),u("div",M,[o[2]||(o[2]=a("h2",null,"Listener Mode",-1)),a("p",null,[o[1]||(o[1]=w("Your Listener ID: ")),a("strong",null,x(n.value),1)]),o[3]||(o[3]=a("label",{for:"hostId"},"Enter Room ID:",-1)),g(a("input",{id:"hostId","onUpdate:modelValue":o[0]||(o[0]=t=>d.value=t),placeholder:"e.g. abcde",style:{display:"block",width:"100%",margin:".5rem 0",padding:".5rem"}},null,512),[[k,d.value]]),a("button",{onClick:f,disabled:s.value||!i.value}," 👂 Join Stream ",8,P),i.value?b("",!0):(m(),u("p",S," Allow mic access to connect... ")),g(a("audio",{ref_key:"remoteAudio",ref:l,autoplay:"",controls:"",playsinline:"",style:{display:"block",width:"100%","margin-top":"1rem"}},null,512),[[I,s.value]])]))}},$={style:{padding:"2rem","max-width":"600px",margin:"auto"}},R={__name:"ListenerView",setup(y){return(p,n)=>(m(),u("div",$,[D(V)]))}};export{R as default};
