import{$ as P}from"./bundler-CViGtuft.js";import{getApps as S,initializeApp as U,getApp as $}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";import{getFirestore as B,collection as R,doc as M,getDoc as V,query as q,where as z,getDocs as K}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";import{_ as j,s as F,r as c,o as L,z as N,c as u,a,t as _,A as x,f as d}from"./index-DjsB7_Em.js";const O={id:"watch-root"},T={key:0,class:"not-found"},W={key:1,class:"loading"},E={key:2,class:"listen-section"},G={__name:"WatchingView",setup(H){const k={apiKey:"AIzaSyAQpMoxAKJrkave5D9e8CqKeLffCCUeGAw",authDomain:"vexa-d596e.firebaseapp.com",projectId:"vexa-d596e",storageBucket:"vexa-d596e.appspot.com",messagingSenderId:"79833394084",appId:"1:79833394084:web:1e5f41859b4125ef342f31"},I=S().length===0?U(k):$(),g=B(I),C=R(g,"vexaUsers");function D(t){const o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?decodeURIComponent(o.pop().split(";").shift()):null}async function A(t){const e=q(C,z("username","==",t)),o=await K(e);if(!o.empty){const r=o.docs[0];return{id:r.id,...r.data()}}return null}const n=F().params.owner,s=c(!0),i=c(!1),w=c(null),p=c(null);return L(async()=>{const t=D("vexaUser"),e=await A(t),o=e==null?void 0:e.PeerID;if(!o){console.error("Viewer PeerID not found for",t),s.value=!1,i.value=!1;return}let r;try{r=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(l){console.warn("Could not get local audio, using empty stream:",l),r=new MediaStream}const b=M(g,"vexaRooms",n),h=await V(b);if(!h.exists()){i.value=!1,s.value=!1;return}w.value=h.data(),i.value=!0,s.value=!1;const f=new P(o);f.on("open",l=>{const y=w.value["Room-Owner-PeerID"];if(!y){console.error("Host PeerID missing for owner:",n);return}const m=f.call(y,r);if(!m){console.error("Call returned undefined — check PeerIDs & stream");return}m.on("stream",async v=>{await N(),p.value&&(p.value.srcObject=v)}),m.on("error",v=>console.error("Call error:",v))}),f.on("error",l=>console.error("Peer error:",l))}),(t,e)=>(d(),u("div",O,[!i.value&&!s.value?(d(),u("div",T,[e[0]||(e[0]=a("h2",null,"Stream Not Found",-1)),a("p",null,'The host "'+_(x(n))+'" is not streaming right now or the room does not exist.',1)])):s.value?(d(),u("div",W,e[1]||(e[1]=[a("p",null,"Checking stream availability…",-1)]))):(d(),u("div",E,[a("h2",null,"Listening to "+_(x(n))+"'s Stream",1),a("audio",{ref_key:"remoteAudio",ref:p,controls:"",autoplay:"",playsinline:"",class:"audio-player"},null,512)]))]))}},ee=j(G,[["__scopeId","data-v-ab7c7c19"]]);export{ee as default};
