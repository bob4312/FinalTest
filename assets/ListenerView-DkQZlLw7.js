import{_ as C,r,o as k,c as n,a as s,b as h,t as p,d as u,w as I,v as L,n as f,f as i,g as x}from"./index-dZ3bHcxy.js";import{$ as D}from"./bundler-CViGtuft.js";const S={class:"listener-container"},P={class:"listener-card"},j={class:"info-section"},M={class:"listener-info"},V={class:"listener-id"},$={class:"connection-section"},A={class:"input-group"},B={class:"input-container"},E=["disabled"],N={key:0,class:"button-icon"},R={key:1,class:"spinner"},J={class:"button-text"},z={key:0,class:"permission-notice"},H={key:1,class:"connection-status"},U={class:"audio-container"},q={__name:"Listener",setup(g){function m(){return Math.random().toString(36).substring(2,7)}const c=r(m()),b=r(""),t=r(!1),l=r(!1),d=r(null);let v=null,_=null;k(async()=>{try{_=await navigator.mediaDevices.getUserMedia({audio:!0}),l.value=!0}catch(a){console.warn("Listener: mic access denied",a)}v=new D(c.value),v.on("open",a=>{c.value=a,console.log("Listener Peer ready with ID:",a)}),v.on("error",a=>{console.error("PeerJS error (listener):",a),alert("Listener error: "+a)})});async function y(){const a=b.value.trim();if(a.length!==5)return alert("Room ID must be exactly 5 characters.");if(!l.value)return alert("Mic not ready; please allow microphone access.");console.log("Calling host:",a);const e=v.call(a,_);e.on("stream",o=>{console.log("🔊 Received remote stream",o),d.value.srcObject=o,d.value.volume=1,d.value.onloadedmetadata=()=>{d.value.play().then(()=>{t.value=!0,console.log("▶️ Playback started")}).catch(w=>{console.error("❌ Playback failed:",w)})}}),e.on("error",o=>{console.error("Call error:",o),alert("Could not connect to host: "+o)}),e.on("close",()=>{console.log("Host closed the call"),t.value=!1})}return(a,e)=>(i(),n("div",S,[s("div",P,[e[7]||(e[7]=h('<div class="header" data-v-9637f5bb><div class="header-content" data-v-9637f5bb><h2 class="title" data-v-9637f5bb>👂 Listener Mode</h2><p class="subtitle" data-v-9637f5bb>Join a live audio stream</p></div><div class="listen-icon" data-v-9637f5bb><div class="sound-waves" data-v-9637f5bb><div class="wave wave-1" data-v-9637f5bb></div><div class="wave wave-2" data-v-9637f5bb></div><div class="wave wave-3" data-v-9637f5bb></div></div></div></div>',1)),s("div",j,[s("div",M,[e[1]||(e[1]=s("span",{class:"info-label"},"Your Listener ID:",-1)),s("div",V,p(c.value),1)])]),s("div",$,[s("div",A,[e[3]||(e[3]=s("label",{for:"hostId",class:"input-label"},"Enter Room ID to join:",-1)),s("div",B,[I(s("input",{id:"hostId","onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),placeholder:"e.g. ABCDE",class:f(["room-input",{error:a.hasError}])},null,2),[[L,b.value]]),e[2]||(e[2]=s("div",{class:"input-icon"},"🔗",-1))])]),s("button",{onClick:y,disabled:t.value||!l.value,class:f(["join-button",{joined:t.value,disabled:!l.value,loading:a.isConnecting}])},[a.isConnecting?u("",!0):(i(),n("span",N,p(t.value?"🎧":"👂"),1)),a.isConnecting?(i(),n("div",R)):u("",!0),s("span",J,p(t.value?"Connected to Stream":"Join Stream"),1)],10,E),l.value?u("",!0):(i(),n("div",z,e[4]||(e[4]=[s("div",{class:"notice-icon"},"⚠️",-1),s("p",{class:"notice-text"},"Please allow microphone access to connect to the stream",-1)]))),t.value?(i(),n("div",H,e[5]||(e[5]=[s("div",{class:"status-dot"},null,-1),s("p",{class:"status-text"},"Connected and streaming",-1)]))):u("",!0)]),s("div",{class:f(["audio-section",{visible:t.value}])},[e[6]||(e[6]=h('<div class="audio-header" data-v-9637f5bb><h3 class="audio-title" data-v-9637f5bb>🎵 Live Audio Stream</h3><div class="equalizer" data-v-9637f5bb><div class="bar bar-1" data-v-9637f5bb></div><div class="bar bar-2" data-v-9637f5bb></div><div class="bar bar-3" data-v-9637f5bb></div><div class="bar bar-4" data-v-9637f5bb></div></div></div>',1)),s("div",U,[s("audio",{ref_key:"remoteAudio",ref:d,autoplay:"",controls:"",playsinline:"",class:"audio-player"},null,512)])],2)])]))}},O=C(q,[["__scopeId","data-v-9637f5bb"]]),T={style:{padding:"2rem","max-width":"600px",margin:"auto"}},G={__name:"ListenerView",setup(g){return(m,c)=>(i(),n("div",T,[x(O)]))}};export{G as default};
