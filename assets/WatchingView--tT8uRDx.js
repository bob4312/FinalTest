import{$ as A}from"./bundler-CViGtuft.js";import{getApps as U,initializeApp as P,getApp as S}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";import{getFirestore as $,collection as B,doc as R,getDoc as V,query as q,where as z,getDocs as K}from"https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";import{_ as M,s as j,r as c,o as F,y as L,c as u,a as r,t as y,z as _,f as d}from"./index-dZ3bHcxy.js";const N={id:"watch-root"},O={key:0,class:"not-found"},T={key:1,class:"loading"},W={key:2,class:"listen-section"},E={__name:"WatchingView",setup(G){const x={apiKey:"AIzaSyAQpMoxAKJrkave5D9e8CqKeLffCCUeGAw",authDomain:"vexa-d596e.firebaseapp.com",projectId:"vexa-d596e",storageBucket:"vexa-d596e.appspot.com",messagingSenderId:"79833394084",appId:"1:79833394084:web:1e5f41859b4125ef342f31"},k=U().length===0?P(x):S(),g=$(k),I=B(g,"vexaUsers");function C(t){const o=`; ${document.cookie}`.split(`; ${t}=`);return o.length===2?decodeURIComponent(o.pop().split(";").shift()):null}async function D(t){const e=q(I,z("username","==",t)),o=await K(e);if(!o.empty){const s=o.docs[0];return{id:s.id,...s.data()}}return null}const p=j().params.owner,a=c(!0),l=c(!1),h=c(null),f=c(null);let i=null;return F(async()=>{const t=C("vexaUser"),e=await D(t),o=e==null?void 0:e.PeerID;if(!o){console.error("Viewer PeerID not found for",t),a.value=!1,l.value=!1;return}let s=null;try{s=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(n){console.warn("Could not get local audio:",n)}const b=R(g,"vexaRooms",p),w=await V(b);if(!w.exists()){l.value=!1,a.value=!1;return}h.value=w.data(),l.value=!0,a.value=!1,i=new A(o),i.on("open",()=>{const n=h.value["Room-Owner-PeerID"],m=i.call(n,s);if(!m){console.error("Call returned undefined — check PeerIDs and stream");return}m.on("stream",async v=>{await L(),f.value&&(f.value.srcObject=v)}),m.on("error",v=>console.error("Call error:",v))}),i.on("error",n=>console.error("Peer error:",n))}),(t,e)=>(d(),u("div",N,[!l.value&&!a.value?(d(),u("div",O,[e[0]||(e[0]=r("h2",null,"Stream Not Found",-1)),r("p",null,'The host "'+y(_(p))+'" is not streaming right now or the room does not exist.',1)])):a.value?(d(),u("div",T,e[1]||(e[1]=[r("p",null,"Checking stream availability…",-1)]))):(d(),u("div",W,[r("h2",null,"Listening to "+y(_(p))+"'s Stream",1),r("audio",{ref_key:"remoteAudio",ref:f,controls:"",autoplay:"",playsinline:"",class:"audio-player"},null,512)]))]))}},Z=M(E,[["__scopeId","data-v-d006bee6"]]);export{Z as default};
